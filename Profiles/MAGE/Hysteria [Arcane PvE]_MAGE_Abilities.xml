<?xml version="1.0" encoding="utf-8" ?><MAGE><Ability><Name>[Misc] Profile Init</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>------------------------------------------------------------
-- Variables &amp; Sanity checks
------------------------
-- PQInterface
if not IsAddOnLoaded(&amp;quot;PQInterface&amp;quot;) then
		PQR_WriteToChat(&amp;quot;|cff9482C9The AddOn PQInterface is not loaded or installed!|cffffffff&amp;quot;,&amp;quot;Warning&amp;quot;)
		PQR_WriteToChat(&amp;quot;|cff9482C9Version 2.22+ is required to run the profile.|cffffffff&amp;quot;,&amp;quot;Warning&amp;quot;)
		PQR_WriteToChat(&amp;quot;&amp;quot;)
		PQR_WriteToChat(&amp;quot;|cff9482C9You can get the latest version at this location:|cffffffff&amp;quot;,&amp;quot;Notice&amp;quot;)
		PQR_WriteToChat(&amp;quot;|cff9482C9http://pqrotation.wikia.com/wiki/PQInterface|cffffffff&amp;quot;,&amp;quot;Notice&amp;quot;)
		PQR_StopRotation()
		return true
else
	local PQIver = tonumber(GetAddOnMetadata(&amp;quot;PQInterface&amp;quot;,&amp;quot;Version&amp;quot;))
	if PQIver &amp;lt; 2.22 then
		PQR_WriteToChat(&amp;quot;|cff9482C9Your PQInterface version is outdated!|cffffffff&amp;quot;,&amp;quot;Warning&amp;quot;)
		PQR_WriteToChat(&amp;quot;|cff9482C9Version 2.22+ is required to run the profile, you have version &amp;quot;..PQIver..&amp;quot;!|cffffffff&amp;quot;,&amp;quot;Warning&amp;quot;)
		PQR_WriteToChat(&amp;quot;&amp;quot;)
		PQR_WriteToChat(&amp;quot;|cff9482C9You can get the latest version at this location:|cffffffff&amp;quot;,&amp;quot;Notice&amp;quot;)
		PQR_WriteToChat(&amp;quot;|cff9482C9http://pqrotation.wikia.com/wiki/PQInterface|cffffffff&amp;quot;,&amp;quot;Notice&amp;quot;)
		PQR_StopRotation()
		return true
	end
end


-- Initialize Load-Once Settings
if PQR_RotationStarted then
	PQR_RotationStarted = false

	-- Load Data Files
	if PQR_LoadLua ~= nil then
		if PQR_LoadLua(&amp;quot;PQR_Hysteria_Data.lua&amp;quot;) == false then
			PQR_WriteToChat(&amp;quot;|cffb73737PQR_Hysteria_Data.lua failed to load. Make sure it&amp;apos;s in your Data folder!|cffffffff&amp;quot;, &amp;quot;Error&amp;quot;)
			PQR_StopRotation()
			return true
		end
		if PQR_LoadLua(&amp;quot;PQR_PQI.lua&amp;quot;) == false then
			PQR_WriteToChat(&amp;quot;|cffb73737PQR_PQI.lua failed to load. Make sure it&amp;apos;s in your Data folder!|cffffffff&amp;quot;, &amp;quot;Error&amp;quot;)
			PQR_StopRotation()
			return true
		end
	end
	
	if not mentallyMageFirstStart then
		-- Initialize Event Tracker
		local Hysteria = CreateFrame(&amp;quot;Frame&amp;quot;)
		Hysteria:RegisterEvent(&amp;quot;COMBAT_LOG_EVENT_UNFILTERED&amp;quot;)
		Hysteria:SetScript(&amp;quot;OnEvent&amp;quot;, HysteriaFrame_OnEvent)
		Hysteria:Show()
		
		mentallyMageFirstStart = true
		PQR_WriteToChat(&amp;quot;|cff69CCF0Hysteria Mage data is |cff82cee7Loaded!|cffffffff&amp;quot;)
	end
end

-- Initialize Variables
PQR_ResetMovementTime = 0.3
PQR_SpellAvailableTime = ((select(3,GetNetStats()) + select(4,GetNetStats())) / 1000)



-- Slash Command Queue
SLASH_ECAST1 = &amp;quot;/ecast&amp;quot;
function SlashCmdList.ECAST(msg, editbox)		
	local spellid, unit = msg:match(&amp;quot;^(%S*)%s*(.-)$&amp;quot;);
	if tonumber(spellid) ~= nil and unit ~= &amp;quot;&amp;quot; then 			
		if not UnitExists(tostring(unit)) and unit ~= &amp;quot;tank&amp;quot; and unit ~= &amp;quot;low&amp;quot; and unit ~= &amp;quot;aoe5&amp;quot; and unit ~= &amp;quot;aoe10&amp;quot; and unit ~= &amp;quot;aoe15&amp;quot; and unit ~= &amp;quot;aoe20&amp;quot; and unit ~= &amp;quot;aoe25&amp;quot; and unit ~= &amp;quot;aoe30&amp;quot; then			
			PQR_WriteToChat(&amp;quot;unit not exist&amp;quot;);
		elseif not IsSpellKnown(tonumber(spellid)) then
			PQR_WriteToChat(&amp;quot;spell unknown&amp;quot;);
		else
			if not Queue_Spell then
				Queue_Spell = { }	
			end				
			table.insert(Queue_Spell, { Unit = unit, SpellID = spellid, Time = GetTime() } )
		end
	else
		PQR_WriteToChat(&amp;quot;Syntax: /ecast spellid unit&amp;quot;);
	end
end

-- First run is insecure
if not FirstQueueSetup then
    RunMacroText(&amp;quot;/ecast&amp;quot;) -- The first time run, it always returns insecure, so getting that first run out of the way
    FirstQueueSetup = true
end

------------------------------------------------------------
-- Misc. Checks
------------------------
-- Reset DoT Tracker if we&amp;apos;re not in combat
if not UnitAffectingCombat(&amp;quot;player&amp;quot;) and #dotTracker &amp;gt; 0 then
	dotTracker = {}
end

-- Invoker&amp;apos;s Energy is a tough nut to crack
if invokeTimer then
	if GetTime() - invokeTimer &amp;gt; 0.5 then
		if not UnitChannelInfo(&amp;quot;player&amp;quot;) and (not UnitBuffID(&amp;quot;player&amp;quot;,PQ_Invo) or
			(UnitBuffID(&amp;quot;player&amp;quot;,PQ_Invo) and select(7,UnitBuffID(&amp;quot;player&amp;quot;,PQ_Invo)) &amp;lt; 10)) then
				mentalMessage:message(&amp;quot;\124cFFAADD00 Evocation interrupted.  Invoker&amp;apos;s Energy not updated.&amp;quot;)
				stopRotation = false
				invokeTimer = false
		end
	end		
end

-- We want to pause the entire profile when we&amp;apos;re doing certain things..
if UnitIsDeadOrGhost(&amp;quot;player&amp;quot;)		-- Snap! Deaded
	or UnitBuffID(&amp;quot;player&amp;quot;,104934)	-- Eating (Feast/Banquet)
	or UnitBuffID(&amp;quot;player&amp;quot;,80169)	-- Eating Normal
	or UnitBuffID(&amp;quot;player&amp;quot;,87959)	-- Drinking Normal
	or UnitBuffID(&amp;quot;player&amp;quot;,11392)	-- 18 sec Invis Pot (for CMs)
	or UnitBuffID(&amp;quot;player&amp;quot;,3680)	-- 15 sec Invis pot  (for CMs)
	or UnitBuffID(&amp;quot;player&amp;quot;,32612)	-- Invisibility (Base Mage Spell)
	or UnitBuffID(&amp;quot;player&amp;quot;,110960)	-- Greater Invisibility (Talented Spell)
	or IsMounted()					-- Mounted, lol. Get it?
	or stopRotation					-- My personal work-around!
then return true end

if (not PQI_MentallyDefensiveSettings_WipeCauterize_enable
	or not PQI_MentallyDefensiveSettings_IceBlock_enable)
and UnitBuffID(&amp;quot;player&amp;quot;,45438) then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Combat Detection</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyOffensiveSettings_CombatDetection_enable then return false end

if (not UnitAffectingCombat(&amp;quot;player&amp;quot;) and UnitExists(&amp;quot;boss1&amp;quot;))
	or not UnitAffectingCombat(&amp;quot;player&amp;quot;)
then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Hold: Pause Rotation</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyDefensiveSettings_PauseRotation_enable then return false end

if PQI:IsHotkeys(PQI_MentallyDefensiveSettings_PauseRotation_key)
	and not GetCurrentKeyBoardFocus() then return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Pet Management</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_WElm = PQ_WElm

-- In case we haven&amp;apos;t learned it yet for some reason!
if not IsPlayerSpell(PQ_WElm) then return false end

-- Don&amp;apos;t try to cast while we&amp;apos;re falling or flying.
if IsFalling() or IsFlying() then return false end

-- Let&amp;apos;s try to not spam the ability as well..
if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(PQ_WElm) then return false end

-- We&amp;apos;re on a CD
if not PQR_SpellAvailable(PQ_WElm) then return false end

if not UnitExists(&amp;quot;pet&amp;quot;) then
	CastSpellByName(GetSpellInfo(PQ_WElm),nil) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Automatic Buffing</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Buffing
local PQ_FA = PQ_FA
local PQ_AuraInfo = PQ_AuraInfo
local spec = GetSpecialization()

if UnitAffectingCombat(&amp;quot;player&amp;quot;) then return false end

-- Attempt to not spam the ability.
if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(PQ_FA) and UnitBuffID(&amp;quot;player&amp;quot;,PQ_FA) then
	RunMacroText(&amp;quot;/stopcasting&amp;quot;)
end
if UnitCastingInfo(&amp;quot;player&amp;quot;) or UnitChannelInfo(&amp;quot;player&amp;quot;) then return false end

-- Mage Armor
if spec == 1 then	-- Arcane
	if IsPlayerSpell(PQ_MA) and not UnitBuffID(&amp;quot;player&amp;quot;,PQ_MA) then
		CastSpellByName(GetSpellInfo(PQ_MA),&amp;quot;player&amp;quot;) return true
	end
end

-- Arcane Brilliance
if IsPlayerSpell(PQ_ABril) and (not PQ_AuraInfo(5,&amp;quot;player&amp;quot;) or not PQ_AuraInfo(7,&amp;quot;player&amp;quot;)) then
	CastSpellByName(GetSpellInfo(PQ_ABril),&amp;quot;player&amp;quot;) return true
end

-- Arcane Brilliance: Raid Buffing
if PQI_MentallyDefensiveSettings_RaidBuffing_enable then
	if IsInRaid() then group = &amp;quot;raid&amp;quot;
		elseif IsInGroup() then group = &amp;quot;party&amp;quot;
	else return false end
	
	for i=1,GetNumGroupMembers() do
		local member = group..i
		if (not PQ_AuraInfo(5,member) or not PQ_AuraInfo(7,member)) and IsSpellInRange(GetSpellInfo(PQ_ABril),member) == 1 then
			if UnitIsDeadOrGhost(member) then return false end
			if PQR_IsOutOfSight(member,1) then return false end
			
			CastSpellByName(GetSpellInfo(PQ_ABril),member) return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Player</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Create Mana Gem</Name><Default>false</Default><SpellID>759</SpellID><Actions></Actions><Lua>local manaGem = 759
local manaGlyph = 56383
local regularGem = 36799
local glyphedGem = 81901

if PQR_IsMoving(0.1) then return false end

-- Not yet learned
if not IsPlayerSpell(759) then return false end

-- Glyphing it makes all the difference in the world...
if IsPlayerSpell(manaGlyph) then manaGem = 119316 else manaGem = 759 end

-- Don&amp;apos;t spam the ability
if UnitCastingInfo(&amp;quot;player&amp;quot;) == GetSpellInfo(manaGem) then return false end

-- Create!
if IsPlayerSpell(manaGlyph) then
	if GetItemCount(glyphedGem,nil,true) &amp;lt; 10
		and not UnitAffectingCombat(&amp;quot;player&amp;quot;)
	then CastSpellByName(GetSpellInfo(manaGem),&amp;quot;player&amp;quot;) return true end
else
	if GetItemCount(regularGem,nil,true) &amp;lt; 3
		and not UnitAffectingCombat(&amp;quot;player&amp;quot;)
	then CastSpellByName(GetSpellInfo(manaGem),&amp;quot;player&amp;quot;) return true end
end</Lua><RecastDelay>1000</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Spell Queue System</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyOffensiveSettings_SpellQueueType_enable then return false end
local v=PQI_MentallyOffensiveSettings_SpellQueueType_value or 1

if v == 1 then
	if IsMouseButtonDown() and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		if GetMouseFocus():GetName() ~= nil then
			SpellCancelQueuedSpell()
			RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
		end
	end
elseif v == 2 then
	if GetMouseFocus():GetName() ~= nil and UnitAffectingCombat(&amp;quot;player&amp;quot;) then
		SpellCancelQueuedSpell()
		RunMacroText(&amp;quot;/click &amp;quot;..GetMouseFocus():GetName())
	end
end

-- QueueSys
if not Queue_Spell then
	Queue_Spell = { }	
end	

if Queue_Spell then
	if #Queue_Spell &amp;gt; 0 then
		if GetTime() - Queue_Spell[1].Time &amp;gt;= 1.5 then
			--PQR_WriteToChat(&amp;quot;Removed expired queue &amp;quot;..Queue_Spell[1].SpellID)
			Queue_Spell = { }
			return true
		end			
		if #Queue_Spell &amp;gt; 1 then
			if Queue_Spell[1].SpellID == Queue_Spell[2].SpellID and Queue_Spell[1].Unit == Queue_Spell[2].Unit then
				--PQR_WriteToChat(&amp;quot;Removed dup queue &amp;quot;..Queue_Spell[1].SpellID)
				table.remove(Queue_Spell,2)
				return true	
			end
		end
		
		local qunit = &amp;quot;player&amp;quot;
		if Queue_Spell[1].Unit ~= nil then
			qunit = Queue_Spell[1].Unit
		end
		if PQR_SpellAvailable(tonumber(Queue_Spell[1].SpellID)) 
		and ((select(2,GetSpellCooldown(tonumber(Queue_Spell[1].SpellID))) &amp;lt; 2
		and Queue_Spell[1].SpellID ~= 51886)
		or (select(2,GetSpellCooldown(tonumber(dispelid2))) &amp;lt; 2
		and Queue_Spell[1].SpellID == 51886))
		and UnitExists(qunit)
		then
			if not UnitChannelInfo(&amp;quot;player&amp;quot;)
			and not UnitCastingInfo(&amp;quot;player&amp;quot;) 
			then					
				if IsSpellInRange(GetSpellInfo(Queue_Spell[1].SpellID),Queue_Spell[1].Unit) then
					qunit = Queue_Spell[1].Unit	
				else
					qunit = &amp;quot;player&amp;quot;				
				end
				SpellSUCCEEDED(Queue_Spell[1].SpellID,qunit)
				CastSpellByName(tostring(GetSpellInfo(Queue_Spell[1].SpellID)),qunit)									
				return true						
			end
		end	
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Trigger: Hold Cooldowns</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>------------------------------------------------------------
-- Cooldown Hold Trigger
------------------------
if not SCDtimer then SCDtimer = 0 end
if not SCD then SCD = false end
if not PQI_MentallyOffensiveSettings_ToggleHoldCooldown_enable then return false end

if SCD then
	PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cooldown Hold: Enabled&amp;quot;, nil, &amp;quot;DC143C&amp;quot;)
else
	PQR_Event(&amp;quot;PQR_Text&amp;quot;, &amp;quot;Cooldown Hold: Disabled&amp;quot;, nil, &amp;quot;79BAEC&amp;quot;)
end

if PQI_MentallyOffensiveSettings_ToggleHoldCooldown_enable
	and not GetCurrentKeyBoardFocus()
	and PQI:IsHotkeys(PQI_MentallyOffensiveSettings_ToggleHoldCooldown_key)
	and GetTime() - SCDtimer &amp;gt; 1
then
	SCDtimer = GetTime()
	if SCD then
		SCD = false
		PQR_WriteToChat(&amp;quot;|cff347C2CCooldown Hold: |cff79BAECDisabled|cffffffff&amp;quot;, &amp;quot;Notice&amp;quot;)
	else
		SCD = true
		PQR_WriteToChat(&amp;quot;|cff347C2CCooldown Hold: |cffDC143CEnabled|cffffffff&amp;quot;, &amp;quot;Notice&amp;quot;)
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Auto: Potion</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local T2D = T2D
local PQ_HasHero = PQ_HasHero
local SpecialUnit = SpecialUnit

-- Don&amp;apos;t use Potion during Heroism if user tagged off automatic use
if not PQI_MentallyOffensiveSettings_AutoPotion_enable then return false end

-- Disable if we have no potions left
if GetItemCount(76093) &amp;lt; 1 then return false end

-- Disable if Potion is on cooldown
if GetItemCooldown(76093) ~= 0 then return false end

-- Disable if we&amp;apos;re not targeting a boss
if not SpecialUnit() then return false end

-- Disable if we don&amp;apos;t have Heroism or T2D is greater than 20 seconds
if not PQ_HasHero() or T2D(&amp;quot;target&amp;quot;) &amp;gt; 20 then return false end

-- At this point, we should just use the potion if all of the above is true
UseItemByName(76093)</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Boss Immunities</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Let&amp;apos;s try and detect immunities
if UnitBuffID(&amp;quot;target&amp;quot;,116994) or UnitBuffID(&amp;quot;target&amp;quot;,122540) or UnitBuffID(&amp;quot;target&amp;quot;,123250) or UnitBuffID(&amp;quot;target&amp;quot;,106062) or UnitBuffID(&amp;quot;target&amp;quot;,110945)
	then return false end
	
-- Cancel spell casts or channels on Silences
if UnitExists(&amp;quot;boss1&amp;quot;) or UnitExists(&amp;quot;target&amp;quot;) then
	if UnitCastingInfo(&amp;quot;boss1&amp;quot;) == GetSpellInfo(138763) or UnitCastingInfo(&amp;quot;target&amp;quot;) == GetSpellInfo(137457) then
		if UnitCastingInfo(&amp;quot;player&amp;quot;) or UnitChannelInfo(&amp;quot;player&amp;quot;) then RunMacroText(&amp;quot;/stopcasting&amp;quot;) return false end
		return true
	end
end
	
-- Twin Consorts (Immune while channeling Nuclear Inferno and Tidal Force)
if UnitChannelInfo(&amp;quot;target&amp;quot;) == GetSpellInfo(137531) or UnitChannelInfo(&amp;quot;target&amp;quot;) == GetSpellInfo(137491) or UnitCastingInfo(&amp;quot;target&amp;quot;) == GetSpellInfo(138763)
	then return false end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Frag Belt</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Ability disabled in PQI
if not PQI_MentallyOffensiveSettings_FragBelt_enable then return false end

-- If we don&amp;apos;t know Engineering. Don&amp;apos;t activate.
for i=1,9 do
	if select(7,GetProfessionInfo(i)) == 202 then hasEngi = true end
end

-- Don&amp;apos;t have Engineering.
if not hasEngi then return false end

local Belt = GetInventoryItemID(&amp;quot;player&amp;quot;, 6)

-- Not equipped?
if not IsEquippedItem(Belt) then return false end

-- Don&amp;apos;t use it if it&amp;apos;s on cooldown as well!
if GetItemCooldown(Belt) &amp;gt; 0 then return false end

-- Cast Frag Belt
if GetCurrentKeyBoardFocus() == nil and UnitIsUnit(&amp;quot;target&amp;quot;, &amp;quot;mouseover&amp;quot;) then
	UseItemByName(Belt)
	if SpellIsTargeting() then CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Healthstone</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Disable ability if we disabled it in PQI
if not PQI_MentallyDefensiveSettings_Healthstone_enable then return false end

local v=PQI_MentallyDefensiveSettings_Healthstone_value

if GetItemCount(5512) &amp;gt; 0
	and Hysteria_UnitInfo(&amp;quot;player&amp;quot;) &amp;lt;= v
	and PQR_SpellAvailable(5512)
	and GetItemCooldown(5512) == 0
then UseItemByName(5512) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Herbalism: Lifeblood</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local SpecialUnit = SpecialUnit

-- Herbalism&amp;apos;s Lifeblood
PQ_Lifeblood = {81708,74497,121279,55428,55480,55500,55501,55502,55503}

for i=1,#PQ_Lifeblood do
	if IsPlayerSpell(PQ_Lifeblood[i])
		and PQR_SpellAvailable(PQ_Lifeblood[i])
		and SpecialUnit()
		and not SCD
	then
		if not PQI_MentallyOffensiveSettings_BossCooldown_enable then
			CastSpellByName(GetSpellInfo(PQ_Lifeblood[i]),&amp;quot;player&amp;quot;)
			return true
		else
			if SpecialUnit() then
				CastSpellByName(GetSpellInfo(PQ_Lifeblood[i]),&amp;quot;player&amp;quot;)
				return true
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Racials</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local T2D = T2D
local PQ_IV = PQ_IV
local SpecialUnit = SpecialUnit
local spec = GetSpecialization()
local Hysteria_UnitInfo = Hysteria_UnitInfo

-- Don&amp;apos;t use Racials if user tagged off automatic use
if not PQI_MentallyOffensiveSettings_AutoRacials_enable then return false end

-- Draenei: Gift of the Naaru
if IsPlayerSpell(59544) and PQR_SpellAvailable(59544) and Hysteria_UnitInfo(&amp;quot;player&amp;quot;) &amp;lt; 60 then
	CastSpellByName(GetSpellInfo(59544),&amp;quot;player&amp;quot;)
	return true
end

-- Troll: Berserking
if IsPlayerSpell(26297) and not SCD then
	if PQR_SpellAvailable(26297) then
		if not PQI_MentallyOffensiveSettings_BossCooldown_enable then
			if UnitExists(&amp;quot;target&amp;quot;) then
				SpellCancelQueuedSpell()
				CastSpellByName(GetSpellInfo(26297),&amp;quot;player&amp;quot;)
				return true
			end
		else
			if SpecialUnit() then
				if spec == 3 and (UnitBuffID(&amp;quot;player&amp;quot;,PQ_IV) or T2D(&amp;quot;target&amp;quot;) &amp;lt; 18) then
					SpellCancelQueuedSpell()
					CastSpellByName(GetSpellInfo(26297),&amp;quot;player&amp;quot;)
					return true
				end
			end
		end
	end
end

-- Blood Elf: Arcane Torrent
if IsPlayerSpell(28730) and not SCD then
	if PQR_SpellAvailable(28730) and select(3,Hysteria_UnitInfo(&amp;quot;player&amp;quot;)) &amp;lt; 92
		and UnitExists(&amp;quot;target&amp;quot;) then
			SpellCancelQueuedSpell()
			CastSpellByName(GetSpellInfo(28730),&amp;quot;player&amp;quot;)
			return true
	end
end

-- Orc: Blood Fury
if IsPlayerSpell(33702) and not SCD then
	if PQR_SpellAvailable(33702) then
		if not PQI_MentallyOffensiveSettings_BossCooldown_enable then
			if UnitExists(&amp;quot;target&amp;quot;) then
				SpellCancelQueuedSpell()
				CastSpellByName(GetSpellInfo(33702),&amp;quot;player&amp;quot;)
				return true
			end
		else
			if SpecialUnit() then
				if spec == 3 and (UnitBuffID(&amp;quot;player&amp;quot;,PQ_IV) or T2D(&amp;quot;target&amp;quot;) &amp;lt; 18) then
					SpellCancelQueuedSpell()
					CastSpellByName(GetSpellInfo(33702),&amp;quot;player&amp;quot;)
					return true
				end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Fire Blast (Movement)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FBlast = PQ_FBlast
local TargetValidation = TargetValidation

if not PQR_IsMoving(0.1) then return false end

-- We don&amp;apos;t know it ..?
if not IsPlayerSpell(PQ_FBlast) then return false end

-- On a cooldown!
if not PQR_SpellAvailable(PQ_FBlast) then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_FBlast) then
	CastSpellByName(GetSpellInfo(PQ_FBlast),&amp;quot;target&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Arcane Barrage</Name><Default>false</Default><SpellID>44425</SpellID><Actions></Actions><Lua>-- Barrage
local PQ_ATB = PQ_ATB
local PQ_ACD = PQ_ACD
local PQ_Barrage = PQ_Barrage
local spellCooldown = spellCooldown
local TargetValidation = TargetValidation
local mana = select(3,Hysteria_UnitInfo(&amp;quot;player&amp;quot;))

-- Not yet learned
if not IsPlayerSpell(PQ_Barrage) then return false end

-- Blast locked?!
if not PQR_SpellAvailable(PQ_Barrage) then return false end

if PQ_GetDebuffStacks(PQ_ACD) &amp;gt;= 4 and mana &amp;lt; 95 then
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_Barrage) then
		CastSpellByName(GetSpellInfo(PQ_Barrage),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>300</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_NT = PQ_NT
local PQ_LB = PQ_LB
local PQ_FrostBomb = PQ_FrostBomb
local TargetValidation = TargetValidation

if IsPlayerSpell(PQ_NT) then
	local NT = select(7,UnitDebuffID(&amp;quot;target&amp;quot;,PQ_NT,&amp;quot;PLAYER&amp;quot;))
	if not PQR_SpellAvailable(PQ_NT) then return false end
	
	if NT then
		if NT - GetTime() &amp;lt; 2  or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,122,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,33395,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,39965,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,44572,&amp;quot;PLAYER&amp;quot;)) then 
			if TargetValidation(&amp;quot;target&amp;quot;,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;target&amp;quot;) return true end
		end
	else
		if TargetValidation(&amp;quot;target&amp;quot;,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;target&amp;quot;) return true end
	end
end

if IsPlayerSpell(PQ_LB) then
	local LB = select(7,UnitDebuffID(&amp;quot;target&amp;quot;,PQ_LB,&amp;quot;PLAYER&amp;quot;))
	if not PQR_SpellAvailable(PQ_LB) then return false end
	
	if LivingBomb &amp;lt; 3 then
		if LB then
			if LB - GetTime() &amp;lt; 1.5 then
				if TargetValidation(&amp;quot;target&amp;quot;,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;target&amp;quot;) return true end
			end
		else
			if TargetValidation(&amp;quot;target&amp;quot;,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;target&amp;quot;) return true end
		end
	end
end

if IsPlayerSpell(PQ_FrostBomb) then
	if not PQR_SpellAvailable(PQ_FrostBomb) then return false end
	if PQR_IsMoving(0.1) then return false end
	
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_FrostBomb) then
		CastSpellByName(GetSpellInfo(PQ_FrostBomb),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mirror Image</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_MI = PQ_MI
local SpecialUnit = SpecialUnit
local PQ_Blast = PQ_Blast
local TargetValidation = TargetValidation

if not PQI_MentallyOffensiveSettings_AutoMirrorImage_enable then return false end

-- Boss Cooldowns enabled
if PQI_MentallyOffensiveSettings_BossCooldown_enable then
	if not SpecialUnit() then return false end
end

-- Haven&amp;apos;t learned Mirror Image yet!
if not IsPlayerSpell(PQ_MI) then return false end

-- Spell is on a cooldown
if not PQR_SpellAvailable(PQ_MI) then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_Blast) and not SCD then
	mentalMessage:message(&amp;quot;\124cFFAADD00Casting: Mirror Image&amp;quot;)
	CastSpellByName(GetSpellInfo(PQ_MI),&amp;quot;target&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Presence of Mind</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_POM = PQ_POM
local SpecialUnit = SpecialUnit

-- Not an active talent!
if not IsPlayerSpell(PQ_POM) then return false end

-- Either Arcane locked, or it&amp;apos;s on a cooldown...
if not PQR_SpellAvailable(PQ_POM) then return false end

-- Should we only cast it on boss-units?
if PQI_MentallyOffensiveSettings_BossCooldown_enable then
	if not SpecialUnit() then return false end
end

-- Are we saving this cooldown?
if SCD then return false end

CastSpellByName(GetSpellInfo(PQ_POM),&amp;quot;player&amp;quot;) return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Arcane Blast</Name><Default>false</Default><SpellID>30451</SpellID><Actions></Actions><Lua>local PQ_Blast = PQ_Blast
local TargetValidation = TargetValidation

-- Somehow on a CD?
if not PQR_SpellAvailable(PQ_Frostbolt) then return false end

-- Ice Floes support
if PQI_MentallyOffensiveSettings_AutoIceFloes_enable and PQR_IsMoving(0.1) then
	if PQR_SpellAvailable(108839) and IsPlayerSpell(108839) then
		CastSpellByName(GetSpellInfo(108839),&amp;quot;player&amp;quot;)
		if TargetValidation(&amp;quot;target&amp;quot;,PQ_Blast) then
			CastSpellByName(GetSpellInfo(PQ_Blast),&amp;quot;target&amp;quot;) return true
		end
	end
end

-- Bad bad movement...
if PQR_IsMoving(0.1) then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_Blast) then
	CastSpellByName(GetSpellInfo(PQ_Blast),&amp;quot;target&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Alter Time</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Alter Time
local PQ_AT = PQ_AT
local PQ_IV = PQ_IV
local PQ_ATB = PQ_ATB

-- Cancel upon movement
if UnitBuffID(&amp;quot;player&amp;quot;,PQ_ATB) then
	if PQR_IsMoving(0.1) then
		SpellCancelQueuedSpell()
		CastSpellByName(GetSpellInfo(PQ_AT),&amp;quot;player&amp;quot;)
		return true
	end
end

-- Spell not available
if not PQR_SpellAvailable(PQ_AT) then return false end

-- Manual keybinding enabled
if PQI_MentallyOffensiveSettings_AlterTime_enable
	and PQI:IsHotkeys(PQI_MentallyOffensiveSettings_AlterTime_key)
	and not GetCurrentKeyBoardFocus()
	and not UnitBuffID(&amp;quot;player&amp;quot;,PQ_ATB)
then
	SpellCancelQueuedSpell()
	CastSpellByName(GetSpellInfo(PQ_AT),&amp;quot;player&amp;quot;)
	return true
end	

-- Don&amp;apos;t use while moving.
if PQR_IsMoving(0.1) then return false end

-- Sanity checks
if not UnitBuffID(&amp;quot;player&amp;quot;,PQ_AP) then return false end

-- Automatic usage disabled in PQI
if not PQI_MentallyOffensiveSettings_AutoAlterTime_enable then return false end

mentalMessage:message(&amp;quot;\124cFFAADD00Casting: Alter Time&amp;quot;)
CastSpellByName(GetSpellInfo(PQ_AT),&amp;quot;player&amp;quot;) return true</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Arcane Barrage (Alter Time)</Name><Default>false</Default><SpellID>44425</SpellID><Actions></Actions><Lua>--Arcane Barrage (AT)
local PQ_ATB = PQ_ATB
local PQ_Barrage = PQ_Barrage
local spellCooldown = spellCooldown
local TargetValidation = TargetValidation

-- Not yet learned
if not IsPlayerSpell(PQ_Barrage) then return false end

-- Blast locked?!
if not PQR_SpellAvailable(PQ_Barrage) then return false end

if UnitBuffID(&amp;quot;player&amp;quot;,PQ_ATB) then
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_Barrage) then
		CastSpellByName(GetSpellInfo(PQ_Barrage),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>300</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Use Mana Gem</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local regularGem = 36799
local glyphedGem = 81901
local mana = select(3,Hysteria_UnitInfo(&amp;quot;player&amp;quot;))
local Hysteria_UnitInfo = Hysteria_UnitInfo
local v = PQI_MentallyDefensiveSettings_ManaGem_value or 80

-- Disabled in PQI
if not PQI_MentallyDefensiveSettings_ManaGem_enable then return false end

-- Glyphed Mana Gem; Returns more mana, use if available!
if GetItemCount(glyphedGem,nil,true) &amp;gt;= 1 and GetItemCooldown(glyphedGem) == 0 and mana &amp;lt; v
	then UseItemByName(glyphedGem) return true end

-- Otherwise default to the boring old one......
if GetItemCount(regularGem,nil,true) &amp;gt;= 1 and GetItemCooldown(regularGem) == 0 and mana &amp;lt; v
	then UseItemByName(regularGem) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Symbiosis</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Symbiosis = 113074
local Hysteria_UnitInfo = Hysteria_UnitInfo
local v = PQI_MentallyDefensiveSettings_Symbiosis_value or 25

-- Disabled in PQI
if not PQI_MentallyDefensiveSettings_Symbiosis_enable then return false end

if Hysteria_UnitInfo(&amp;quot;player&amp;quot;) &amp;lt; v then
	CastSpellByName(GetSpellInfo(PQ_Symbiosis),&amp;quot;player&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Spell Singer</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Spellsteal = 30449
local targetTable = {&amp;quot;target&amp;quot;,&amp;quot;focus&amp;quot;,&amp;quot;mouseover&amp;quot;,&amp;quot;arena1&amp;quot;,&amp;quot;arena2&amp;quot;,&amp;quot;arena3&amp;quot;,&amp;quot;arena4&amp;quot;,&amp;quot;arena5&amp;quot;,&amp;quot;boss1&amp;quot;,&amp;quot;boss2&amp;quot;,&amp;quot;boss3&amp;quot;,&amp;quot;boss4&amp;quot;}

-- Disabled in PQI
if not PQI_MentallyDefensiveSettings_SpellSinger_enable then return false end

-- Not an attackable target
if not UnitExists(&amp;quot;target&amp;quot;) or not UnitIsEnemy(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) or not UnitCanAttack(&amp;quot;player&amp;quot;,&amp;quot;target&amp;quot;) then return false end

-- Unit is dead, pass!
if UnitIsDeadOrGhost(&amp;quot;target&amp;quot;) then return false end

for i=1,#targetTable do
	for k=1,40 do
		if select(9,UnitBuff(targetTable[i],k)) ~= nil then
			CastSpellByName(GetSpellInfo(PQ_Spellsteal),targetTable[i]) return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Remove Curse</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_RemoveCurse = 475

-- Ability disabled in PQI
if not PQI_MentallyDefensiveSettings_RemoveCurse_enable then return false end

-- Ability is on a cooldown!
if not PQR_SpellAvailable(PQ_RemoveCurse) then return false end

-- Remove curses on Player
for i=1,40 do
	if select(5,UnitDebuff(&amp;quot;player&amp;quot;,i)) == &amp;quot;Curse&amp;quot; then
		CastSpellByName(GetSpellInfo(PQ_RemoveCurse),&amp;quot;player&amp;quot;) return true
	end
end

-- Detect our &amp;quot;group&amp;quot; size..
if IsInRaid() then group = &amp;quot;raid&amp;quot; elseif IsInGroup() then group = &amp;quot;party&amp;quot; else return false end

-- Remove curses from raid members
for i=1,GetNumGroupMembers() do
	local member = group..i
	
	if UnitIsDeadOrGhost(member) then return false end
	if PQR_IsOutOfSight(member,1) then return false end
	
	for k=1,40 do
		if select(5,UnitDebuff(member,k)) == &amp;quot;Curse&amp;quot; then
			CastSpellByName(GetSpellInfo(PQ_RemoveCurse),member) return true
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb (Focus)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_NT = PQ_NT
local PQ_LB = PQ_LB
local PQ_FrostBomb = PQ_FrostBomb
local TargetValidation = TargetValidation

if not PQI_MentallyOffensiveSettings_FocusDotting_enable then return false end

if IsPlayerSpell(PQ_NT) then
	local NT = select(7,UnitDebuffID(&amp;quot;focus&amp;quot;,PQ_NT,&amp;quot;PLAYER&amp;quot;))
	if not PQR_SpellAvailable(PQ_NT) then return false end
	
	if NT then
		if NT - GetTime() &amp;lt; 2 or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,122,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,33395,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,39965,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,44572,&amp;quot;PLAYER&amp;quot;)) then 
			if TargetValidation(&amp;quot;focus&amp;quot;,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;focus&amp;quot;) return true end
		end
	else
		if TargetValidation(&amp;quot;focus&amp;quot;,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;focus&amp;quot;) return true end
	end
end

if IsPlayerSpell(PQ_LB) then
	local LB = select(7,UnitDebuffID(&amp;quot;focus&amp;quot;,PQ_LB,&amp;quot;PLAYER&amp;quot;))
	if not PQR_SpellAvailable(PQ_LB) then return false end
	
	if LivingBomb &amp;lt; 3 then
		if LB then
			if LB - GetTime() &amp;lt; 1.5 then
				if TargetValidation(&amp;quot;focus&amp;quot;,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;focus&amp;quot;) return true end
			end
		else
			if TargetValidation(&amp;quot;focus&amp;quot;,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;focus&amp;quot;) return true end
		end
	end
end

if IsPlayerSpell(PQ_FrostBomb) then
	if not PQR_SpellAvailable(PQ_FrostBomb) then return false end
	if PQR_IsMoving(0.1) then return false end
	
	if TargetValidation(&amp;quot;focus&amp;quot;,PQ_FrostBomb) then
		CastSpellByName(GetSpellInfo(PQ_FrostBomb),&amp;quot;focus&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb (Mouseover)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_NT = PQ_NT
local PQ_LB = PQ_LB
local PQ_FrostBomb = PQ_FrostBomb
local TargetValidation = TargetValidation

if not PQI_MentallyOffensiveSettings_MouseoverDotting_enable then return false end

if IsPlayerSpell(PQ_NT) then
	local NT = select(7,UnitDebuffID(&amp;quot;mouseover&amp;quot;,PQ_NT,&amp;quot;PLAYER&amp;quot;))
	if not PQR_SpellAvailable(PQ_NT) then return false end
	
	if NT then
		if NT - GetTime() &amp;lt; 2 or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,122,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,33395,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,39965,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,44572,&amp;quot;PLAYER&amp;quot;)) then 
			if TargetValidation(&amp;quot;mouseover&amp;quot;,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;mouseover&amp;quot;) return true end
		end
	else
		if TargetValidation(&amp;quot;mouseover&amp;quot;,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),&amp;quot;mouseover&amp;quot;) return true end
	end
end

if IsPlayerSpell(PQ_LB) then
	local LB = select(7,UnitDebuffID(&amp;quot;mouseover&amp;quot;,PQ_LB,&amp;quot;PLAYER&amp;quot;))
	if not PQR_SpellAvailable(PQ_LB) then return false end
	
	if LivingBomb &amp;lt; 3 then
		if LB then
			if LB - GetTime() &amp;lt; 1.5 then
				if TargetValidation(&amp;quot;mouseover&amp;quot;,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;mouseover&amp;quot;) return true end
			end
		else
			if TargetValidation(&amp;quot;mouseover&amp;quot;,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),&amp;quot;mouseover&amp;quot;) return true end
		end
	end
end

if IsPlayerSpell(PQ_FrostBomb) then
	if not PQR_SpellAvailable(PQ_FrostBomb) then return false end
	if PQR_IsMoving(0.1) then return false end
	
	if TargetValidation(&amp;quot;mouseover&amp;quot;,PQ_FrostBomb) then
		CastSpellByName(GetSpellInfo(PQ_FrostBomb),&amp;quot;mouseover&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Mage Bomb (Boss)</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_NT = PQ_NT
local PQ_LB = PQ_LB
local PQ_FrostBomb = PQ_FrostBomb
local TargetValidation = TargetValidation

for i=1,4 do
	local bossUnit = &amp;quot;boss&amp;quot;..i
	
	-- Let&amp;apos;s try and detect immunities
	if UnitBuffID(bossUnit,116994) or UnitBuffID(bossUnit,122540) or UnitBuffID(bossUnit,123250) or UnitBuffID(bossUnit,106062) or UnitBuffID(bossUnit,110945)
		then return false end
	
	if IsPlayerSpell(PQ_NT) then
		local NT = select(7,UnitDebuffID(bossUnit,PQ_NT,&amp;quot;PLAYER&amp;quot;))
		if IsSpellInRange(GetSpellInfo(PQ_NT),bossUnit) == 0 then return false end
		if not PQR_SpellAvailable(PQ_NT) then return false end
		
		if NT then
			if NT - GetTime() &amp;lt; 2 or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,122,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,33395,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,39965,&amp;quot;PLAYER&amp;quot;)) or
			select(7,UnitDebuffID(&amp;quot;target&amp;quot;,44572,&amp;quot;PLAYER&amp;quot;)) then 
				if TargetValidation(bossUnit,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),bossUnit) return true end
			end
		else
			if TargetValidation(bossUnit,PQ_NT) then CastSpellByName(GetSpellInfo(PQ_NT),bossUnit) return true end
		end
	end
	
	if IsPlayerSpell(PQ_LB) then
		local LB = select(7,UnitDebuffID(bossUnit,PQ_LB,&amp;quot;PLAYER&amp;quot;))
		if IsSpellInRange(GetSpellInfo(PQ_LB),bossUnit) == 0 then return false end
		if not PQR_SpellAvailable(PQ_LB) then return false end
		
		if LivingBomb &amp;lt; 3 then
			if LB then
				if LB - GetTime() &amp;lt; 1.5 then
					if TargetValidation(bossUnit,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),bossUnit) return true end
				end
			else
				if TargetValidation(bossUnit,PQ_LB) then CastSpellByName(GetSpellInfo(PQ_LB),bossUnit) return true end
			end
		end
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Level 30 Talent</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Barrier = PQ_Barrier
local PQ_Temporal = PQ_Temporal

-- Disable PQI keybind
if not PQI_MentallyDefensiveSettings_Level30Talent_enable then return false end
if PQI_MentallyDefensiveSettings_AutoIceBarrier_enable
	and IsPlayerSpell(PQ_Barrier) then return false end

if IsPlayerSpell(PQ_Barrier) then
	if PQR_SpellAvailable(PQ_Barrier)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level30Talent_key)
		and not GetCurrentKeyBoardFocus() then
			SpellCancelQueuedSpell() CastSpellByName(GetSpellInfo(PQ_Barrier),&amp;quot;player&amp;quot;) return true
	end
end

if IsPlayerSpell(PQ_Temporal) then
	if PQR_SpellAvailable(PQ_Temporal)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level30Talent_key)
		and not GetCurrentKeyBoardFocus() then
			SpellCancelQueuedSpell() CastSpellByName(GetSpellInfo(PQ_Temporal),&amp;quot;player&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Level 45 Talent</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FJ = PQ_FJ
local PQ_IW = PQ_IW
local PQ_RoF = PQ_RoF

if not PQI_MentallyDefensiveSettings_Level45Talent_enable then return false end

if IsPlayerSpell(PQ_FJ) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_FJ)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level45Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_FJ),&amp;quot;target&amp;quot;) return true
	end
end

if IsPlayerSpell(PQ_IW) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_IW)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level45Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_IW),&amp;quot;target&amp;quot;) return true
	end
end

if IsPlayerSpell(PQ_RoF) then
	if PQR_IsMoving(0.1) then return false end

	if PQR_SpellAvailable(PQ_RoF)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level45Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_RoF),nil)
			if SpellIsTargeting() then SpellCancelQueuedSpell() CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
			return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[AOE] Flamestrike</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_FS = PQ_FS

if PQR_IsMoving(0.1) then return false end

if not PQR_SpellAvailable(PQ_FS) then return false end

if PQI_MentallyOffensiveSettings_AOEMode_enable
	and PQI:IsHotkeys(PQI_MentallyOffensiveSettings_AOEMode_key)
	and not GetCurrentKeyBoardFocus()
then
	SpellCancelQueuedSpell()
	CastSpellByName(GetSpellInfo(PQ_FS),nil)
	if SpellIsTargeting() then SpellCancelQueuedSpell() CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[AOE] Cone of Cold</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_CoC = PQ_CoC

if not PQR_SpellAvailable(PQ_CoC) then return false end

if UnitExists(&amp;quot;target&amp;quot;) and not (PQR_UnitDistance(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;) &amp;lt; 13) then return false end

if not PQR_UnitFacing(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;) then return false end

if PQI_MentallyOffensiveSettings_AOEMode_enable
	and PQI:IsHotkeys(PQI_MentallyOffensiveSettings_AOEMode_key)
	and not GetCurrentKeyBoardFocus()
then SpellCancelQueuedSpell() CastSpellByName(GetSpellInfo(PQ_CoC),nil) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[AOE] Blizzard</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Round = PQ_Round
local PQ_Blizzard = PQ_Blizzard
local haste = PQ_Round(UnitSpellHaste(&amp;quot;player&amp;quot;),2)

if PQR_IsMoving(0.1) then return false end

if not PQR_SpellAvailable(PQ_Blizzard) then return false end

if PQI_MentallyOffensiveSettings_AOEMode_enable
	and PQI:IsHotkeys(PQI_MentallyOffensiveSettings_AOEMode_key)
	and not GetCurrentKeyBoardFocus()
then
	SpellCancelQueuedSpell()
	if SpellIsTargeting() then SpellCancelQueuedSpell() CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
	CastSpellByName(GetSpellInfo(PQ_Blizzard),nil)
	return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[AOE] Arcane Explosion</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Round = PQ_Round
local PQ_Explosion = PQ_Explosion
local haste = PQ_Round(UnitSpellHaste(&amp;quot;player&amp;quot;),2)

if not PQR_IsMoving(0.1) then return false end

if UnitExists(&amp;quot;target&amp;quot;) and not (PQR_UnitDistance(&amp;quot;player&amp;quot;, &amp;quot;target&amp;quot;) &amp;lt; 13) then return false end

if not PQR_SpellAvailable(PQ_Explosion) then return false end

if PQI_MentallyOffensiveSettings_AOEMode_enable
	and PQI:IsHotkeys(PQI_MentallyOffensiveSettings_AOEMode_key)
	and not GetCurrentKeyBoardFocus()
then SpellCancelQueuedSpell() CastSpellByName(GetSpellInfo(PQ_Explosion),nil) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Misc] Level 90 Talent</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_Evo = PQ_Evo
local PQ_RoP = PQ_RoP
local PQ_Invo = PQ_Invo
local PQ_Ward = PQ_Ward
local PQ_ATB = PQ_ATB
local PQ_InvoBuff = PQ_InvoBuff
local mana = select(3,Hysteria_UnitInfo(&amp;quot;player&amp;quot;))

-- Disable Level 90 Talents
if not PQI_MentallyDefensiveSettings_Level90Talent_enable then return false end


-- Invocation
if IsPlayerSpell(PQ_Invo) then
	if PQR_IsMoving(0.1) then return false end
	
	if PQR_SpellAvailable(PQ_Evo)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level90Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_Evo),&amp;quot;player&amp;quot;) return true
	end
	
	if not UnitAffectingCombat(&amp;quot;player&amp;quot;) then return false end
	
	if PQ_GetIVCooldown() == 0 and mana &amp;lt; 50 then
		CastSpellByName(GetSpellInfo(PQ_Evo),&amp;quot;player&amp;quot;)
		return true
	end
	
	if UnitBuffID(&amp;quot;player&amp;quot;, PQ_ATB) and mana &amp;gt; 20 then return false end
	
	if select(7,UnitBuffID(&amp;quot;player&amp;quot;, PQ_InvoBuff)) then
	 if select(7,UnitBuffID(&amp;quot;player&amp;quot;, PQ_InvoBuff)) &amp;gt; 1.5 and mana &amp;gt; 20 then return false end
	end
	
	CastSpellByName(GetSpellInfo(PQ_Evo),&amp;quot;player&amp;quot;)
	
	return true
end

-- Rune of Power
if IsPlayerSpell(PQ_RoP) then
	if PQR_IsMoving(0.1) then return false end
	
	if PQR_SpellAvailable(PQ_RoP)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level90Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_RoP),nil)
			if SpellIsTargeting() then SpellCancelQueuedSpell() CameraOrSelectOrMoveStart() CameraOrSelectOrMoveStop() end
			return true
	end
end

-- Incanter&amp;apos;s Ward
if IsPlayerSpell(PQ_Ward) then
	if PQR_SpellAvailable(PQ_Ward)
		and PQI:IsHotkeys(PQI_MentallyDefensiveSettings_Level90Talent_key)
		and not GetCurrentKeyBoardFocus() then
			CastSpellByName(GetSpellInfo(PQ_Ward),&amp;quot;player&amp;quot;)
			return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Auto: Ice Barrier</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>if not PQI_MentallyDefensiveSettings_AutoIceBarrier_enable then return false end

if IsPlayerSpell(PQ_Barrier) then
	if PQR_SpellAvailable(PQ_Barrier) and not UnitBuffID(&amp;quot;player&amp;quot;,PQ_Barrier) then
		CastSpellByName(GetSpellInfo(PQ_Barrier),&amp;quot;player&amp;quot;) return true
	end
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Ice Block</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_IB = PQ_IB
local Hysteria_UnitInfo = Hysteria_UnitInfo
local v=PQI_MentallyDefensiveSettings_IceBlock_value or 35

if PQI_MentallyDefensiveSettings_WipeCauterize_enable then
	if UnitBuffID(&amp;quot;player&amp;quot;,PQ_IB) then CancelUnitBuff(&amp;quot;player&amp;quot;,GetSpellInfo(PQ_IB)) return true end
	
	if not PQR_SpellAvailable(PQ_IB) then
		if IsPlayerSpell(11958) and PQR_SpellAvailable(11958) then
			CastSpellByName(GetSpellInfo(11958),&amp;quot;player&amp;quot;)
		end
	else
		if UnitDebuffID(&amp;quot;player&amp;quot;,86949) then CastSpellByName(GetSpellInfo(PQ_IB),&amp;quot;player&amp;quot;) return true end
	end
	return false
end

if PQI_MentallyDefensiveSettings_IceBlock_enable then
	if Hysteria_UnitInfo(&amp;quot;player&amp;quot;) &amp;lt; v then
		if not PQR_SpellAvailable(PQ_IB) then
			if IsPlayerSpell(11958) and PQR_SpellAvailable(11958) then
				CastSpellByName(GetSpellInfo(11958),&amp;quot;player&amp;quot;)
			end
		else CastSpellByName(GetSpellInfo(PQ_IB),&amp;quot;player&amp;quot;) return true end
	end
	return false
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Synapse Springs</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>-- Synapse
local PQ_AT = PQ_AT
local PQ_MI = PQ_MI
local PQ_Blast = PQ_Blast
local MICD = spellCooldown(PQ_MI)
local TargetValidation = TargetValidation
local Gloves = GetInventoryItemID(&amp;quot;player&amp;quot;, 10)

-- If we don&amp;apos;t know Engineering. Don&amp;apos;t activate.
for i=1,9 do
	if select(7,GetProfessionInfo(i)) == 202 then hasEngi = true end
end

-- Don&amp;apos;t have Engineering.
if not hasEngi then return false end

-- Item not equipped?
if not IsEquippedItem(Gloves) then return false end

-- Don&amp;apos;t use it if it&amp;apos;s on cooldown as well!
if GetItemCooldown(Gloves) &amp;gt; 0 then return false end

if spellCooldown(PQ_AT) &amp;gt; 45 or (IsPlayerSpell(PQ_Invo) and PQ_GetInvoLeft() &amp;lt; 20) then return false end

if PQR_SpellAvailable(PQ_MI) or MICD &amp;lt; 40 then return false end

-- Cast Engineering Gloves
if TargetValidation(&amp;quot;target&amp;quot;,PQ_Blast) then
	mentalMessage:message(&amp;quot;\124cFFAADD00Using: Synapse Springs&amp;quot;)
	UseItemByName(Gloves) return true end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>[Support] Cold Snap</Name><Default>false</Default><SpellID>0</SpellID><Actions></Actions><Lua>local PQ_CS = PQ_CS
local Hysteria_UnitInfo = Hysteria_UnitInfo
local v=PQI_MentallyDefensiveSettings_ColdSnap_value or 30

if not PQI_MentallyDefensiveSettings_ColdSnap_enable then return false end
if not PQR_SpellAvailable(PQ_CS) then return false end

if Hysteria_UnitInfo(&amp;quot;player&amp;quot;) &amp;lt;= v then
	CastSpellByName(GetSpellInfo(PQ_CS),&amp;quot;player&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Arcane Missiles (Alter Time)</Name><Default>false</Default><SpellID>5143</SpellID><Actions></Actions><Lua>-- Arcane Missiles (AT)
local PQ_Missiles = PQ_Missiles
local spellCooldown = spellCooldown
local TargetValidation = TargetValidation

-- Bad bad movement...
if PQR_IsMoving(0.1) then return false end

-- Not yet learned
if not IsPlayerSpell(PQ_Missiles) then return false end

-- Arcane locked?!
if not PQR_SpellAvailable(PQ_Missiles) then return false end

if UnitBuffID(&amp;quot;player&amp;quot;,PQ_ATB) then
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_Missiles) then
		CastSpellByName(GetSpellInfo(PQ_Missiles),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>200</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Arcane Missiles</Name><Default>false</Default><SpellID>5143</SpellID><Actions></Actions><Lua>-- Missiles
local PQ_Missiles = PQ_Missiles
local PQ_AP = PQ_AP
local PQ_ACD = PQ_ACD
local PQ_AMB = PQ_AMB
local spellCooldown = spellCooldown
local TargetValidation = TargetValidation

-- Bad bad movement...
if PQR_IsMoving(0.1) then return false end

-- Not yet learned
if not IsPlayerSpell(PQ_Missiles) then return false end

-- Arcane locked?!
if not PQR_SpellAvailable(PQ_Missiles) then return false end

if (PQ_GetBuffStacks(PQ_AMB) == 2 and spellCooldown(PQ_AP)&amp;gt;0) or
  (PQ_GetDebuffStacks(PQ_ACD) &amp;gt;= 4 and spellCooldown(PQ_AP) &amp;gt; 8) then
	if TargetValidation(&amp;quot;target&amp;quot;,PQ_Missiles) then
		--PQR_WriteToChat(&amp;quot;|cff9482C9AMB Stacks:&amp;quot;.. (PQ_GetBuffStacks(PQ_AMB)) ..&amp;quot; AP CD&amp;quot; .. (spellCooldown(PQ_AP)) .. &amp;quot;|cffffffff&amp;quot;,&amp;quot;Notice&amp;quot;)
		CastSpellByName(GetSpellInfo(PQ_Missiles),&amp;quot;target&amp;quot;) return true
	end
end</Lua><RecastDelay>200</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability><Ability><Name>Arcane Power</Name><Default>false</Default><SpellID>12042</SpellID><Actions></Actions><Lua>local T2D = T2D
local PQ_AP = PQ_AP
local SCD = SCD
local PQ_Blast = PQ_Blast
local SpecialUnit = SpecialUnit
local TargetValidation = TargetValidation

-- Spell not available
if not PQR_SpellAvailable(PQ_AP) then return false end

-- Manual keybinding enabled
if PQI_MentallyOffensiveSettings_ArcanePower_enable
	and PQI:IsHotkeys(PQI_MentallyOffensiveSettings_ArcanePower_key)
	and not GetCurrentKeyBoardFocus()
then CastSpellByName(GetSpellInfo(PQ_AP),&amp;quot;player&amp;quot;) return true end

-- Don&amp;apos;t use while moving.
if PQR_IsMoving(0.1) then return false end

-- Did we enable boss only CDs?
if PQI_MentallyOffensiveSettings_BossCooldown_enable then
	if not SpecialUnit() then return false end
end

if (PQ_GetBuffStacks(PQ_AMB)&amp;lt;2 or PQ_GetDebuffStacks(PQ_ACD)&amp;gt;3)
  and T2D(&amp;quot;target&amp;quot;)&amp;gt;30 then return false end

-- Automatic usage disabled in PQI
if not PQI_MentallyOffensiveSettings_AutoArcanePower_enable then return false end

if TargetValidation(&amp;quot;target&amp;quot;,PQ_Blast) and not SCD then
	mentalMessage:message(&amp;quot;\124cFFAADD00Casting: Arcane Power&amp;quot;)
	CastSpellByName(&amp;quot;Arcane Power&amp;quot;,&amp;quot;player&amp;quot;) return true
end</Lua><RecastDelay>0</RecastDelay><Target>Target</Target><CancelChannel>False</CancelChannel><SkipUnknown>True</SkipUnknown></Ability></MAGE>